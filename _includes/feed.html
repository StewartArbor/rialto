{% assign lang = page.lang | default: "en" %}
{% assign items = site.data.items | where: "active", true %}

{% if page.cat %}
  {% assign items = items | where: "category", page.cat %}
{% endif %}

{% assign items = items | sort: "added" | reverse %}


<div class="feed" id="dealFeed">

{% for item in items %}

  {% assign title = item.title[lang] | default: item.title.en %}
  {% assign desc  = item.desc[lang]  | default: item.desc.en %}
  {% assign price = item.price_fmt[lang] | default: item.price_fmt.en %}
  {% assign oldp  = item.old_price_fmt[lang] | default: item.old_price_fmt.en %}

  <article class="deal">

    <div class="deal-image">
      <img src="{{ item.image }}" loading="lazy" alt="{{ title }}">
    </div>

    <div class="deal-body">

      <h3 class="deal-title">{{ title }}</h3>

      <p class="deal-desc">{{ desc }}</p>

      <div class="deal-price">

        <span class="price-now">{{ price }}</span>

        {% if item.old_price %}
        <span class="price-old">{{ oldp }}</span>
        {% endif %}

        {% if item.discount %}
        <span class="price-discount">-{{ item.discount }}%</span>
        {% endif %}

      </div>

      <a class="btn"
         href="{{ item.link }}"
         target="_blank"
         rel="nofollow noopener">

        {% if lang == "ru" %}
          Открыть
        {% elsif lang == "kz" %}
          Ашу
        {% else %}
          Open
        {% endif %}

      </a>

    </div>

  </article>

{% endfor %}

</div>

<div class="pager" id="pager"></div>

<script>
(function(){
  const PAGE_SIZE = 12;
  const feed = document.getElementById('dealFeed');
  const pager = document.getElementById('pager');
  if(!feed || !pager) return;

  const cards = Array.from(feed.querySelectorAll('article.deal'));
  if(cards.length <= PAGE_SIZE) return;

  let page = 1;
  const pages = Math.ceil(cards.length / PAGE_SIZE);

  function render(){
    const start = (page-1)*PAGE_SIZE;
    const end = start + PAGE_SIZE;
    cards.forEach((c,i)=> c.style.display = (i>=start && i<end) ? '' : 'none');

    pager.innerHTML = '';
    const prev = document.createElement('button');
    prev.textContent = '←';
    prev.disabled = page===1;
    prev.onclick = ()=>{ page--; render(); };

    const next = document.createElement('button');
    next.textContent = '→';
    next.disabled = page===pages;
    next.onclick = ()=>{ page++; render(); };

    const label = document.createElement('span');
    label.textContent = `Page ${page} / ${pages}`;

    pager.append(prev,label,next);
  }

  render();
})();
</script>


</div>
